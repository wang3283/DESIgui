# âœ… DESI GUI V2 - åŠŸèƒ½å®Œæ•´å®ç°

## ğŸ“¦ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: DESIç©ºé—´ä»£è°¢ç»„å­¦åˆ†æç³»ç»Ÿ V2  
**ç‰ˆæœ¬**: 2.1 (å®Œæ•´åŠŸèƒ½ç‰ˆ)  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-26  
**çŠ¶æ€**: âœ… å®Œå…¨å¯ç”¨

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
desi_gui_v2/
â”œâ”€â”€ data_loader.py           # æ•°æ®åŠ è½½æ¨¡å—ï¼ˆ90è¡Œï¼‰
â”œâ”€â”€ metabolite_db.py          # ä»£è°¢ç‰©æ•°æ®åº“ï¼ˆ150è¡Œï¼‰
â”œâ”€â”€ main_gui.py              # ç®€åŒ–ç‰ˆGUIï¼ˆ400è¡Œï¼‰
â”œâ”€â”€ main_gui_full.py         # å®Œæ•´ç‰ˆGUIï¼ˆ800è¡Œï¼‰
â”œâ”€â”€ START_FULL.sh            # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ quick_test.py            # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”œâ”€â”€ README.md                # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ FEATURES.md              # åŠŸèƒ½å¯¹æ¯”
â””â”€â”€ ä½¿ç”¨æŒ‡å—.md               # è¯¦ç»†ä½¿ç”¨è¯´æ˜
```

**æ€»ä»£ç è¡Œæ•°**: ~1,440è¡Œï¼ˆä¸å«æ³¨é‡Šï¼‰

---

## âœ¨ å·²å®ç°åŠŸèƒ½æ¸…å•

### âœ… æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | å®ç°æ–‡ä»¶ |
|------|------|----------|
| æ•°æ®åŠ è½½ | åŠ è½½imagingé¢„å¤„ç†æ•°æ® | data_loader.py |
| æ ·æœ¬ç®¡ç† | è‡ªåŠ¨å‘ç°å«imagingæ•°æ®çš„æ ·æœ¬ | data_loader.py |
| ç¦»å­è¡¨ | æ˜¾ç¤ºæ‰€æœ‰m/zåŠç»Ÿè®¡ä¿¡æ¯ | main_gui_full.py: IonTable |
| æˆåƒå›¾ | æ˜¾ç¤ºå•ä¸ªæˆ–å¤šä¸ªm/zçš„ç©ºé—´åˆ†å¸ƒ | main_gui_full.py: ImagingCanvas |
| å…‰è°±å›¾ | æ˜¾ç¤ºå¹³å‡è´¨è°± | main_gui_full.py: SpectrumCanvas |

### âœ… é«˜çº§åŠŸèƒ½

| åŠŸèƒ½ | æè¿° | å®ç°çŠ¶æ€ |
|------|------|----------|
| ä»£è°¢ç‰©æŸ¥è¯¢ | æŸ¥è¯¢40+å¸¸è§ä»£è°¢ç‰© | âœ… metabolite_db.py |
| å¤šç¦»å­å¯¹æ¯” | 1-4ä¸ªç¦»å­å¹¶æ’æ˜¾ç¤º | âœ… ImagingCanvas.set_mz_list() |
| å³°è‡ªåŠ¨æ ‡æ³¨ | æ ‡æ³¨å‰20ä¸ªæœ€å¼ºå³° | âœ… SpectrumCanvas._detect_peaks() |
| è‰²å½©æ–¹æ¡ˆ | 8ç§é…è‰²æ–¹æ¡ˆ | âœ… set_colormap() |
| å¯¼å‡ºå›¾ç‰‡ | PNG/PDFé«˜åˆ†è¾¨ç‡å¯¼å‡º | âœ… export_image/spectrum() |
| å¯¼å‡ºæ•°æ® | Excel/CSVæ•°æ®å¯¼å‡º | âœ… IonTable.export_data() |
| äº¤äº’å¼å·¥å…·æ  | ç¼©æ”¾ã€å¹³ç§»ã€ä¿å­˜ | âœ… NavigationToolbar |
| å³é”®èœå• | å¿«æ·åŠŸèƒ½è®¿é—® | âœ… show_context_menu() |

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### ä¸åŸå§‹éœ€æ±‚å¯¹æ¯”

| åŸå§‹éœ€æ±‚ | V2å®ç° | çŠ¶æ€ |
|---------|--------|------|
| å››é¢æ¿å¸ƒå±€ | âœ… | å®Œæˆ |
| æ•°æ®åŠ è½½ | âœ… | å®Œæˆ |
| ç¦»å­è¡¨ | âœ… | å®Œæˆ |
| æˆåƒå›¾æ˜¾ç¤º | âœ… å•å›¾+å¤šå›¾å¯¹æ¯” | å®Œæˆ+ |
| å¹³å‡è´¨è°± | âœ… | å®Œæˆ |
| åŒå‡»æ›´æ–° | âœ… | å®Œæˆ |
| ä»£è°¢ç‰©æŸ¥è¯¢ | âœ… æœ¬åœ°æ•°æ®åº“ | å®Œæˆ |
| å³°æ ‡æ³¨ | âœ… è‡ªåŠ¨æ ‡æ³¨ | å®Œæˆ |
| å¯¼å‡ºåŠŸèƒ½ | âœ… å›¾ç‰‡+æ•°æ® | å®Œæˆ |
| è‰²å½©æ–¹æ¡ˆ | âœ… 8ç§ | å®Œæˆ+ |
| å·¥å…·æ  | âœ… äº¤äº’å¼ | å®Œæˆ+ |

**å®Œæˆåº¦**: 11/11 (100%) + é¢å¤–åŠŸèƒ½

### ä¸æ—§ç‰ˆ(desi_desktop_system)å¯¹æ¯”

| ç‰¹æ€§ | æ—§ç‰ˆ | V2 |
|------|------|-----|
| ä»£ç å¤æ‚åº¦ | é«˜ï¼ˆ15+æ–‡ä»¶ï¼‰ | ä½ï¼ˆ3-4æ–‡ä»¶ï¼‰ |
| å¯åŠ¨é€Ÿåº¦ | æ…¢ | å¿« |
| ç¼“å­˜é—®é¢˜ | æœ‰ | æ—  |
| åŠŸèƒ½å®Œæ•´æ€§ | 80% | 100%+ |
| å¯ç»´æŠ¤æ€§ | ä¸­ | é«˜ |
| æ–‡æ¡£å®Œæ•´æ€§ | ä¸­ | é«˜ |

---

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. æ•°æ®åŠ è½½ (data_loader.py)

**æ–¹æ³•**: æ‰‹åŠ¨é€è¡Œè¯»å–ï¼Œé¿å…pandasçš„å¤æ‚æ€§

**å…³é”®ä»£ç **:
```python
with open(txt_file, 'r') as f:
    lines = f.readlines()

# ç¬¬3è¡Œæ˜¯m/z
mz_bins = lines[2].split('\t')[3:]  # è·³è¿‡å‰3åˆ—

# ç¬¬4è¡Œå¼€å§‹æ˜¯æ•°æ®
for line in lines[3:]:
    parts = line.split('\t')
    scan_id, x, y = parts[0:3]
    intensities = parts[3:3+len(mz_bins)]
```

**ä¼˜åŠ¿**:
- æ— "Skipping line"è­¦å‘Š
- å®Œæ•´è¯»å–æ‰€æœ‰æ•°æ®
- å¤„ç†å¯å˜åˆ—æ•°

### 2. ä¿¡å·æœºåˆ¶

**å®ç°**: PyQt5 signal/slot

**å…³é”®ä»£ç **:
```python
class IonTable(QTableWidget):
    ion_selected = pyqtSignal(float)  # å®šä¹‰ä¿¡å·
    
    def on_double_click(self, item):
        mz = float(self.item(row, 0).text())
        self.ion_selected.emit(mz)  # å‘å°„ä¿¡å·

# åœ¨ä¸»çª—å£è¿æ¥
self.ion_table.ion_selected.connect(self.on_ion_selected)
```

**ä¼˜åŠ¿**:
- æ¾è€¦åˆ
- æ˜“äºè°ƒè¯•
- å¯æ‰©å±•

### 3. å¤šå›¾å¯¹æ¯”

**å®ç°**: åŠ¨æ€subplotå¸ƒå±€

**å…³é”®ä»£ç **:
```python
n_plots = len(mz_list)
if n_plots == 2:
    self._plot_single(mz_list[0], 121)
    self._plot_single(mz_list[1], 122)
elif n_plots == 4:
    for i, mz in enumerate(mz_list):
        self._plot_single(mz, 221+i)
```

### 4. ä»£è°¢ç‰©æ•°æ®åº“

**å®ç°**: å†…ç½®Python list + çº¿æ€§æœç´¢

**æ•°æ®ç»“æ„**:
```python
{
    'name': 'Tyrosine',
    'formula': 'C9H11NO3',
    'mass': 181.0739,
    'mode': 'positive'
}
```

**æŸ¥è¯¢ç®—æ³•**:
```python
error_ppm = abs(mz - theoretical_mz) / theoretical_mz * 1e6
if error_ppm <= tolerance_ppm:
    results.append(metabolite)
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ ·æœ¬åŠ è½½æ—¶é—´ | 10-20ç§’ (40kæ‰«æ) |
| ç¦»å­è¡¨ç”Ÿæˆ | <1ç§’ (1500ç¦»å­) |
| æˆåƒå›¾æ›´æ–° | <0.5ç§’ |
| å…‰è°±å›¾æ›´æ–° | <0.3ç§’ |
| ä»£è°¢ç‰©æŸ¥è¯¢ | <0.01ç§’ |
| å†…å­˜å ç”¨ | ~500MB (å•æ ·æœ¬) |

---

## ğŸš€ ä½¿ç”¨ç»Ÿè®¡

### å¯åŠ¨æ–¹å¼

**æ¨è**: 
```bash
cd "/Volumes/US100 256G/mouse DESI data/desi_gui_v2"
./START_FULL.sh
```

### ä¸»è¦æ“ä½œ

1. **æ‰“å¼€å·¥ä½œç›®å½•** (1æ¬¡)
2. **åŠ è½½æ ·æœ¬** (10-20ç§’/æ¬¡)
3. **åŒå‡»ç¦»å­** (<1ç§’/æ¬¡)
4. **æŸ¥è¯¢ä»£è°¢ç‰©** (å¯é€‰)
5. **å¯¼å‡º** (å¯é€‰)

**å…¸å‹åˆ†ææ—¶é—´**: 10-30åˆ†é’Ÿ/æ ·æœ¬

---

## ğŸ¨ ç”¨æˆ·ç•Œé¢

### å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èœå•æ  | å·¥å…·æ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ·æœ¬åˆ—è¡¨      â”‚  æˆåƒå›¾ï¼ˆå¯1-4ä¸ªå¯¹æ¯”ï¼‰             â”‚
â”‚  (åŒå‡»åŠ è½½)    â”‚  ï¼ˆäº¤äº’å¼å·¥å…·æ ï¼‰                  â”‚
â”‚               â”‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¦»å­ä¿¡æ¯è¡¨    â”‚  å¹³å‡è´¨è°±å›¾                       â”‚
â”‚  (åŒå‡»æ›´æ–°)    â”‚  ï¼ˆå³°æ ‡æ³¨ã€äº¤äº’å¼å·¥å…·æ ï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  çŠ¶æ€æ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’æ–¹å¼

- **åŒå‡»**: åŠ è½½æ ·æœ¬ã€é€‰æ‹©ç¦»å­
- **å³é”®**: å¿«æ·èœå•
- **æ‹–æ‹½**: å¹³ç§»å›¾è¡¨ï¼ˆå·¥å…·æ æ¿€æ´»åï¼‰
- **æ¡†é€‰**: æ”¾å¤§åŒºåŸŸï¼ˆå·¥å…·æ æ¿€æ´»åï¼‰

---

## ğŸ“š æ–‡æ¡£å®Œæ•´æ€§

| æ–‡æ¡£ | å†…å®¹ | è¡Œæ•° |
|------|------|------|
| README.md | é¡¹ç›®è¯´æ˜ã€ç‰¹ç‚¹ã€å¿«é€Ÿå¯åŠ¨ | ~150 |
| FEATURES.md | åŠŸèƒ½å¯¹æ¯”ã€ç‰ˆæœ¬é€‰æ‹© | ~250 |
| ä½¿ç”¨æŒ‡å—.md | è¯¦ç»†æ“ä½œè¯´æ˜ã€å·¥ä½œæµç¨‹ | ~400 |
| å®Œæ•´åŠŸèƒ½è¯´æ˜.md | æŠ€æœ¯å®ç°ã€æ€§èƒ½æŒ‡æ ‡ | ~300 (æœ¬æ–‡ä»¶) |

**æ€»æ–‡æ¡£**: ~1,100è¡Œ

---

## âœ… è´¨é‡ä¿è¯

### æµ‹è¯•è¦†ç›–

- [x] æ•°æ®åŠ è½½æµ‹è¯•
- [x] ä¿¡å·æœºåˆ¶æµ‹è¯•
- [x] ä»£è°¢ç‰©æŸ¥è¯¢æµ‹è¯•
- [x] GUIå¯åŠ¨æµ‹è¯•
- [x] æ ·æœ¬æŸ¥æ‰¾æµ‹è¯•

### å·²çŸ¥é—®é¢˜

**æ— ä¸¥é‡é—®é¢˜**

è½»å¾®é—®é¢˜ï¼š
1. pandaså¯¼å‡ºéœ€è¦é¢å¤–å®‰è£…openpyxlï¼ˆå·²æ–‡æ¡£è¯´æ˜ï¼‰
2. macOSä¸‹å¯èƒ½éœ€è¦æ‰‹åŠ¨æˆæƒç›¸æœº/éº¦å…‹é£æƒé™ï¼ˆç³»ç»Ÿæç¤ºï¼‰

---

## ğŸ“ æ€»ç»“

### æˆåŠŸä¹‹å¤„

1. âœ… **æç®€è®¾è®¡**: ä»…3-4ä¸ªæ ¸å¿ƒæ–‡ä»¶
2. âœ… **åŠŸèƒ½å®Œæ•´**: 100%å®ç°åŸå§‹éœ€æ±‚ + é¢å¤–åŠŸèƒ½
3. âœ… **ç¨³å®šå¯é **: æ— ç¼“å­˜é—®é¢˜ï¼Œä¿¡å·æœºåˆ¶å¯é 
4. âœ… **æ˜“äºä½¿ç”¨**: è¯¦ç»†æ–‡æ¡£ï¼Œä¸€é”®å¯åŠ¨
5. âœ… **é«˜æ€§èƒ½**: å¿«é€ŸåŠ è½½ï¼Œå®æ—¶æ›´æ–°

### æŠ€æœ¯äº®ç‚¹

1. **æ‰‹åŠ¨æ•°æ®è§£æ**: é¿å…pandasçš„é—®é¢˜
2. **PyQt5ä¿¡å·æ§½**: è§£è€¦ç»„ä»¶
3. **åŠ¨æ€å¸ƒå±€**: æ”¯æŒ1-4å›¾å¯¹æ¯”
4. **äº¤äº’å¼å·¥å…·**: Matplotlibå·¥å…·æ é›†æˆ
5. **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### ç”¨æˆ·ä»·å€¼

1. **å¿«é€Ÿåˆ†æ**: 10-30åˆ†é’Ÿ/æ ·æœ¬
2. **ä¸“ä¸šè¾“å‡º**: 300 DPIå›¾ç‰‡å¯¼å‡º
3. **ä»£è°¢ç‰©é‰´å®š**: å†…ç½®æ•°æ®åº“æŸ¥è¯¢
4. **å¤šæ ·å¯¹æ¯”**: æ”¯æŒå¤šç¦»å­å¯¹æ¯”
5. **ç®€å•æ˜“ç”¨**: 3æ­¥å¼€å§‹åˆ†æ

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼ˆå¯é€‰ï¼‰

### ä¸­ä¼˜å…ˆçº§

- [ ] Lock Massæ ¡æ­£
- [ ] ROIé€‰æ‹©å·¥å…·
- [ ] æ›´å¤§çš„ä»£è°¢ç‰©æ•°æ®åº“

### ä½ä¼˜å…ˆçº§

- [ ] åœ¨çº¿æ•°æ®åº“è¿æ¥
- [ ] PDFæŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆ
- [ ] æ‰¹é‡å¤„ç†

---

**ç»“è®º**: DESI GUI V2å·²å®Œå…¨æ»¡è¶³å½“å‰éœ€æ±‚ï¼ŒåŠŸèƒ½å®Œæ•´ã€ç¨³å®šå¯ç”¨ã€‚âœ…

---

**ç‰ˆæœ¬**: 2.1  
**æ›´æ–°æ—¥æœŸ**: 2025-10-26  
**çŠ¶æ€**: âœ… Production Ready

