# DESI GUI V2 - é«˜çº§åŠŸèƒ½æ¨¡å—

## ğŸ¯ æ–°å¢æ¨¡å—æ¦‚è§ˆ

### 1. ROI (Region of Interest) åˆ†ææ¨¡å—
**æ–‡ä»¶**: `roi_tools.py` (~400è¡Œ)

#### åŠŸèƒ½ç‰¹ç‚¹
- âœ… **çŸ©å½¢ROIé€‰æ‹©** - ç‚¹å‡»æ‹–æ‹½æ¡†é€‰åŒºåŸŸ
- âœ… **å¤šè¾¹å½¢ROIé€‰æ‹©** - ç‚¹å‡»å®šä¹‰ä»»æ„å¤šè¾¹å½¢
- âœ… **ROIç»Ÿè®¡åˆ†æ** - è®¡ç®—ROIå†…çš„å¼ºåº¦ç»Ÿè®¡
- âœ… **å¤šROIå¯¹æ¯”** - åŒæ—¶åˆ†æå¤šä¸ªæ„Ÿå…´è¶£åŒºåŸŸ
- âœ… **ROIæ•°æ®å¯¼å‡º** - Excel/CSVæ ¼å¼å¯¼å‡ºROIåˆ†æç»“æœ

#### æ ¸å¿ƒç±»

**`ROI` ç±»**:
```python
roi = ROI(
    name="åŒºåŸŸ1",
    roi_type='rectangle',  # 'rectangle', 'polygon', 'circle'
    coords=[x1, y1, x2, y2]
)
```

**`ROIAnalyzer` ç±»**:
```python
analyzer = ROIAnalyzer()
analyzer.add_roi(roi)
stats = analyzer.analyze_roi(roi, data, mz_index)
# è¿”å›: mean, median, std, min, max, cvç­‰ç»Ÿè®¡ä¿¡æ¯
```

**`ROISelector` ç±»**:
```python
selector = ROISelector(ax, callback=on_roi_created)
selector.start_rectangle()  # å¼€å§‹çŸ©å½¢é€‰æ‹©
selector.start_polygon()     # å¼€å§‹å¤šè¾¹å½¢é€‰æ‹©
```

#### ä½¿ç”¨åœºæ™¯
1. **ç»„ç»‡ç‰¹å¼‚æ€§åˆ†æ** - é€‰æ‹©ç‰¹å®šç»„ç»‡åŒºåŸŸåˆ†æä»£è°¢ç‰©åˆ†å¸ƒ
2. **è‚¿ç˜¤vsæ­£å¸¸ç»„ç»‡** - å¯¹æ¯”ä¸åŒåŒºåŸŸçš„ä»£è°¢ç‰©æ°´å¹³
3. **ç©ºé—´å¼‚è´¨æ€§ç ”ç©¶** - åˆ†ææ ·æœ¬å†…çš„ä»£è°¢ç‰©å¼‚è´¨æ€§

---

### 2. æŠ¥å‘Šç”Ÿæˆæ¨¡å—
**æ–‡ä»¶**: `report_generator.py` (~350è¡Œ)

#### åŠŸèƒ½ç‰¹ç‚¹
- âœ… **PDFæ‘˜è¦æŠ¥å‘Š** - è‡ªåŠ¨ç”Ÿæˆå¤šé¡µåˆ†ææŠ¥å‘Š
- âœ… **Excelè¯¦ç»†æŠ¥å‘Š** - å¯¼å‡ºå®Œæ•´æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯
- âœ… **å¤šæ ·æœ¬å¯¹æ¯”æŠ¥å‘Š** - å¯¹æ¯”ä¸åŒæ ·æœ¬çš„ä»£è°¢ç»„å­¦æ•°æ®
- âœ… **å¯è§†åŒ–å›¾è¡¨** - è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡å›¾è¡¨

#### æ ¸å¿ƒç±»

**`ReportGenerator` ç±»**:
```python
generator = ReportGenerator()

# PDFæ‘˜è¦æŠ¥å‘Š
generator.generate_summary_report(data, "report.pdf")
# åŒ…å«: å°é¢, æ•°æ®æ¦‚è§ˆ, å¹³å‡è´¨è°±, æˆåƒç¤ºä¾‹, ç¦»å­ç»Ÿè®¡

# Excelè¯¦ç»†æŠ¥å‘Š
generator.generate_excel_report(data, "report.xlsx")
# åŒ…å«: æ ·æœ¬ä¿¡æ¯, ç¦»å­ç»Ÿè®¡, å‰50é«˜å¼ºåº¦ç¦»å­

# å¤šæ ·æœ¬å¯¹æ¯”
generator.generate_comparison_report(
    data_list=[data1, data2],
    labels=['Sample1', 'Sample2'],
    output_file="comparison.pdf"
)
```

#### æŠ¥å‘Šå†…å®¹

**PDFæ‘˜è¦æŠ¥å‘Š**åŒ…å«:
1. **å°é¢é¡µ** - æ ·æœ¬ä¿¡æ¯ã€ç»Ÿè®¡æ‘˜è¦
2. **æ•°æ®æ¦‚è§ˆ** - æ‰«æä½ç½®ã€å¼ºåº¦åˆ†å¸ƒã€æ£€å‡ºç‡
3. **å¹³å‡è´¨è°±** - å…¨è°±å›¾ã€ä½è´¨é‡åŒºæ”¾å¤§
4. **æˆåƒç¤ºä¾‹** - å‰6ä¸ªé«˜å¼ºåº¦ç¦»å­çš„ç©ºé—´åˆ†å¸ƒ
5. **ç¦»å­ç»Ÿè®¡** - å¼ºåº¦åˆ†å¸ƒã€æ£€å‡ºç‡ç»Ÿè®¡

**Excelè¯¦ç»†æŠ¥å‘Š**åŒ…å«:
- æ ·æœ¬ä¿¡æ¯å·¥ä½œè¡¨
- å®Œæ•´ç¦»å­ç»Ÿè®¡ï¼ˆæ‰€æœ‰m/zï¼‰
- å‰50é«˜å¼ºåº¦ç¦»å­æ’å

#### ä½¿ç”¨åœºæ™¯
1. **é¡¹ç›®æ±‡æŠ¥** - å¿«é€Ÿç”Ÿæˆä¸“ä¸šæŠ¥å‘Š
2. **æ•°æ®å½’æ¡£** - ä¿å­˜å®Œæ•´åˆ†æç»“æœ
3. **å¤šæ ·æœ¬æ¯”è¾ƒ** - æ‰¹é‡åˆ†æå¯¹æ¯”

---

## ğŸ”§ å¦‚ä½•é›†æˆåˆ°GUI

### æ–¹æ³•1ï¼šæ‰©å±•ç°æœ‰GUI

åœ¨`main_gui_full.py`ä¸­æ·»åŠ ï¼š

```python
from roi_tools import ROI, ROIAnalyzer, ROISelector
from report_generator import ReportGenerator

class MainWindow(QMainWindow):
    def __init__(self):
        # ... ç°æœ‰ä»£ç  ...
        self.roi_analyzer = ROIAnalyzer()
        self.report_gen = ReportGenerator()
    
    def create_menu_bar(self):
        # ... ç°æœ‰ä»£ç  ...
        
        # æ·»åŠ ROIèœå•
        roi_menu = self.menuBar().addMenu('ROI')
        
        select_rect_action = QAction('çŸ©å½¢é€‰æ‹©', self)
        select_rect_action.triggered.connect(self.start_rectangle_roi)
        roi_menu.addAction(select_rect_action)
        
        select_poly_action = QAction('å¤šè¾¹å½¢é€‰æ‹©', self)
        select_poly_action.triggered.connect(self.start_polygon_roi)
        roi_menu.addAction(select_poly_action)
        
        analyze_roi_action = QAction('åˆ†æROI', self)
        analyze_roi_action.triggered.connect(self.analyze_rois)
        roi_menu.addAction(analyze_roi_action)
        
        # æ·»åŠ æŠ¥å‘Šèœå•
        report_menu = self.menuBar().addMenu('æŠ¥å‘Š')
        
        pdf_report_action = QAction('ç”ŸæˆPDFæŠ¥å‘Š', self)
        pdf_report_action.triggered.connect(self.generate_pdf_report)
        report_menu.addAction(pdf_report_action)
        
        excel_report_action = QAction('ç”ŸæˆExcelæŠ¥å‘Š', self)
        excel_report_action.triggered.connect(self.generate_excel_report)
        report_menu.addAction(excel_report_action)
```

### æ–¹æ³•2ï¼šç‹¬ç«‹æµ‹è¯•

```python
# æµ‹è¯•ROIåŠŸèƒ½
from roi_tools import ROI, ROIAnalyzer
from data_loader import DataLoader

loader = DataLoader()
data = loader.load_sample("sample.raw")

# åˆ›å»ºROI
roi1 = ROI("åŒºåŸŸ1", 'rectangle', [10, 20, 50, 60])
roi2 = ROI("åŒºåŸŸ2", 'rectangle', [70, 80, 110, 120])

# åˆ†æ
analyzer = ROIAnalyzer()
analyzer.add_roi(roi1)
analyzer.add_roi(roi2)

# å¯¹æ¯”ROI
results = analyzer.compare_rois(data, mz_index=100)
for result in results:
    print(f"{result['name']}: mean={result['mean']:.1f}")

# æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
from report_generator import ReportGenerator

generator = ReportGenerator()
generator.generate_summary_report(data, "report.pdf")
generator.generate_excel_report(data, "report.xlsx")
```

---

## ğŸ“Š åŠŸèƒ½å®Œæˆåº¦æ›´æ–°

| åŠŸèƒ½ | çŠ¶æ€ | æ–‡ä»¶ |
|------|------|------|
| æ•°æ®åŠ è½½ | âœ… | data_loader.py |
| ç¦»å­è¡¨æ˜¾ç¤º | âœ… | main_gui_full.py |
| æˆåƒå›¾ | âœ… | main_gui_full.py |
| å…‰è°±å›¾ | âœ… | main_gui_full.py |
| ä»£è°¢ç‰©æŸ¥è¯¢ | âœ… | metabolite_db.py |
| å¤šç¦»å­å¯¹æ¯” | âœ… | main_gui_full.py |
| å³°æ ‡æ³¨ | âœ… | main_gui_full.py |
| è‰²å½©æ–¹æ¡ˆ | âœ… | main_gui_full.py |
| å¯¼å‡ºå›¾ç‰‡/æ•°æ® | âœ… | main_gui_full.py |
| **ROIé€‰æ‹©åˆ†æ** | âœ… | roi_tools.py |
| **PDFæŠ¥å‘Šç”Ÿæˆ** | âœ… | report_generator.py |
| **ExcelæŠ¥å‘Š** | âœ… | report_generator.py |
| **å¤šæ ·æœ¬å¯¹æ¯”** | âœ… | report_generator.py |
| Lock Massæ ¡æ­£ | ğŸ”„ | (å¯é€‰åŠŸèƒ½) |
| ç¦»å­åˆå¹¶ | ğŸ”„ | (å¯é€‰åŠŸèƒ½) |

---

## ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šè‚¿ç˜¤ç»„ç»‡ä»£è°¢åˆ†æ

```python
# 1. åŠ è½½æ ·æœ¬
data = loader.load_sample("tumor_sample.raw")

# 2. å®šä¹‰ROI
tumor_roi = ROI("è‚¿ç˜¤åŒºåŸŸ", 'rectangle', [50, 50, 100, 100])
normal_roi = ROI("æ­£å¸¸åŒºåŸŸ", 'rectangle', [150, 150, 200, 200])

# 3. åˆ†æç‰¹å®šä»£è°¢ç‰©ï¼ˆå¦‚ä¹³é…¸ï¼‰
analyzer = ROIAnalyzer()
analyzer.add_roi(tumor_roi)
analyzer.add_roi(normal_roi)

# å‡è®¾ä¹³é…¸çš„m/zåœ¨90.0é™„è¿‘
lactate_mz_idx = np.argmin(np.abs(data['mz_bins'] - 90.032))
results = analyzer.compare_rois(data, lactate_mz_idx)

# 4. å¯¹æ¯”
for result in results:
    print(f"{result['name']}: ä¹³é…¸å¹³å‡å¼ºåº¦ = {result['mean']:.1f}")

# 5. ç”ŸæˆæŠ¥å‘Š
generator.generate_summary_report(data, "tumor_analysis.pdf")
```

### ç¤ºä¾‹2ï¼šè¯ç‰©æ²»ç–—æ•ˆæœè¯„ä¼°

```python
# åŠ è½½å¯¹ç…§ç»„å’Œæ²»ç–—ç»„æ ·æœ¬
control_data = loader.load_sample("control.raw")
treated_data = loader.load_sample("treated.raw")

# ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
generator.generate_comparison_report(
    data_list=[control_data, treated_data],
    labels=['å¯¹ç…§ç»„', 'æ²»ç–—ç»„'],
    output_file="treatment_comparison.pdf"
)
```

---

## ğŸš€ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] é›†æˆROIåŠŸèƒ½åˆ°å®Œæ•´ç‰ˆGUI
- [ ] æ·»åŠ æŠ¥å‘Šæ¨¡æ¿è‡ªå®šä¹‰
- [ ] ROIç»Ÿè®¡ç»“æœå®æ—¶æ˜¾ç¤º

### ä¸­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] Lock Massè‡ªåŠ¨æ ¡æ­£
- [ ] ç¦»å­èšç±»åˆ†æ
- [ ] ä¸»æˆåˆ†åˆ†æ(PCA)é›†æˆ

### é•¿æœŸï¼ˆå¯é€‰ï¼‰
- [ ] æœºå™¨å­¦ä¹ åˆ†ç±»
- [ ] é€šè·¯å¯Œé›†åˆ†æ
- [ ] 3Då¯è§†åŒ–

---

## ğŸ“– æ–‡æ¡£æ›´æ–°

æ–°å¢æ–‡æ¡£ï¼š
- `é«˜çº§åŠŸèƒ½è¯´æ˜.md` (æœ¬æ–‡ä»¶)

æ›´æ–°æ–‡æ¡£ï¼š
- `README.md` - æ·»åŠ é«˜çº§åŠŸèƒ½ä»‹ç»
- `ä½¿ç”¨æŒ‡å—.md` - æ·»åŠ ROIå’ŒæŠ¥å‘Šç”Ÿæˆæ•™ç¨‹

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **ROIåˆ†æ**é€‚ç”¨äºï¼š
   - ç»„ç»‡åˆ‡ç‰‡çš„åŒºåŸŸç‰¹å¼‚æ€§åˆ†æ
   - è‚¿ç˜¤vsæ­£å¸¸ç»„ç»‡å¯¹æ¯”
   - ç©ºé—´å¼‚è´¨æ€§ç ”ç©¶

2. **æŠ¥å‘Šç”Ÿæˆ**é€‚ç”¨äºï¼š
   - å¿«é€Ÿæ•°æ®æ±‡æŠ¥
   - å®éªŒè®°å½•å½’æ¡£
   - å¤šæ ·æœ¬æ‰¹é‡åˆ†æ

3. **æœ€ä½³å®è·µ**ï¼š
   - å…ˆåŠ è½½æ ·æœ¬æŸ¥çœ‹æ•´ä½“åˆ†å¸ƒ
   - ä½¿ç”¨ROIå·¥å…·ç²¾ç¡®å®šä½æ„Ÿå…´è¶£åŒºåŸŸ
   - ç”ŸæˆæŠ¥å‘Šä¿å­˜å®Œæ•´åˆ†æç»“æœ

---

**å½“å‰ç‰ˆæœ¬**: V2.2  
**æ–°å¢åŠŸèƒ½**: ROIåˆ†æ + æŠ¥å‘Šç”Ÿæˆ  
**ä»£ç æ€»è¡Œæ•°**: ~2,100+  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œå¯é€‰åŠŸèƒ½å¾…é›†æˆ

