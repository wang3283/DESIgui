# DESI商业化计费系统 - 启动指南

## 快速启动

### 方式1: 启动许可证管理器（管理员工具）

```bash
python license_manager_gui.py
```

**用途:**
- 管理客户信息
- 导入使用报告
- 生成季度账单
- 查看使用统计

---

### 方式2: 启动主DESI软件（客户端）

```bash
python main_gui_ultimate.py
```

**用途:**
- 数据分析和处理
- 自动使用量追踪
- 许可证验证
- 导出使用报告

---

## 界面语言说明

✅ **所有界面已统一为中文**
- 无emoji符号
- 无中英文混用
- 专业的企业级界面

### 修复内容

1. **清理了所有emoji**
   - 菜单项、按钮、标签中的emoji已全部移除
   - 使用专业的文本标签替代

2. **统一了术语**
   - "License" → "许可证"
   - 所有英文标签改为中文

3. **修复的文件**
   - `main_gui_ultimate.py` - 主界面
   - `license_manager_gui.py` - 许可证管理器
   - `import_report_dialog.py` - 报告导入对话框
   - `license_renewal_dialog.py` - 续费对话框
   - `license_validation_dialog.py` - 验证对话框
   - 以及其他36个文件

---

## 首次使用流程

### 管理员端

1. **启动许可证管理器**
   ```bash
   python license_manager_gui.py
   ```

2. **创建测试客户**
   - 点击"新建客户"
   - 填写客户信息
   - 系统自动生成许可证密钥
   - 记录许可证密钥

3. **等待客户使用并导出报告**

4. **导入使用报告**
   - 点击"导入报告"
   - 选择客户发送的.enc文件
   - 系统自动解密和识别

5. **生成账单**
   - 选择客户
   - 点击"生成账单"
   - 选择计费期间
   - 系统自动计算费用

---

### 客户端

1. **启动主程序**
   ```bash
   python main_gui_ultimate.py
   ```

2. **首次启动输入许可证**
   - 输入管理员提供的许可证密钥
   - 系统验证许可证有效性

3. **正常使用软件**
   - 系统自动追踪使用量
   - 无需手动操作

4. **季度结束导出报告**
   - 菜单 → 工具 → 导出使用报告
   - 选择报告期间（90天）
   - 保存为.enc文件
   - 发送给管理员

---

## 系统要求

### Python版本
- Python 3.7 或更高版本

### 依赖库
```bash
pip install PyQt5 cryptography requests pandas numpy matplotlib
```

### 检查依赖
```bash
python -c "import PyQt5, cryptography, requests; print('依赖已安装')"
```

---

## 常见问题

### Q1: 启动时报错"ModuleNotFoundError"

**解决:**
```bash
pip install PyQt5 cryptography requests
```

### Q2: 界面显示乱码

**解决:**
- 确保系统支持中文显示
- 检查字体设置
- 重启程序

### Q3: 许可证验证失败

**解决:**
- 检查许可证密钥是否正确
- 确认许可证未过期
- 联系管理员重新生成

### Q4: 无法导入报告

**解决:**
- 确认报告文件格式为.enc
- 检查客户是否在系统中
- 查看详细错误信息

---

## 测试验证

### 运行测试套件
```bash
# 运行所有测试
python -m pytest tests/ -v

# 当前状态：66个测试全部通过 ✅
```

### 快速功能测试

**许可证管理器:**
```bash
python license_manager_gui.py
# 检查：菜单栏、按钮、对话框是否全中文
```

**主程序:**
```bash
python main_gui_ultimate.py
# 检查：界面元素是否无emoji，全中文
```

---

## 界面预览

### 许可证管理器界面

**菜单栏:**
- 文件 → 导入使用报告、导出数据、退出
- 编辑 → 新建客户、编辑客户、删除客户
- 工具 → 生成账单、使用统计、完整性验证
- 帮助 → 关于

**主界面:**
- 左侧：客户列表（搜索、筛选）
- 右侧：客户详情、使用图表、账单列表

### 主DESI软件界面

**菜单栏:**
- [文件] 文件 → 打开工作目录、导出数据
- [统计] 分析 → 代谢物查询、数据过滤
- [配置] 工具 → Lock Mass校准、许可证信息
- 帮助 → 关于

**工具栏:**
- 刷新、应用校准、导出校准数据、切换显示

**控制面板:**
- 打开工作目录、更新成像图、多样本比对

---

## 技术支持

### 查看日志
```bash
# 主程序日志
tail -f ~/.desi_analytics/usage_data.log

# 许可证管理器日志
tail -f license_manager.log
```

### 数据库位置
```bash
# 客户端数据库
~/.desi_analytics/usage_data.db

# 管理员数据库
./license_manager.db
```

### 配置文件
```bash
# 许可证配置
~/.desi_analytics/license_config.txt

# 许可证密钥
~/.desi_analytics/license.key
```

---

## 更新日志

### v1.0.0 (2024-12-11)
- ✅ 完成语言统一（全中文）
- ✅ 清理所有emoji符号
- ✅ 统一License术语为"许可证"
- ✅ 修复36个文件
- ✅ 所有66个测试通过

---

## 相关文档

- `QUARTERLY_BILLING_GUIDE.md` - 季度计费使用指南
- `DUPLICATE_REPORT_HANDLING.md` - 重复报告处理说明
- `LANGUAGE_CLEANUP_SUMMARY.md` - 语言清理总结
- `MAIN_GUI_CLEANUP_REPORT.md` - 主界面清理报告

---

## 快速命令

```bash
# 启动管理员工具
python license_manager_gui.py

# 启动客户端
python main_gui_ultimate.py

# 运行测试
python -m pytest tests/ -v

# 检查语法
python -m py_compile main_gui_ultimate.py
python -m py_compile license_manager_gui.py
```

---

现在您可以启动程序了！界面将完全使用中文显示，没有任何emoji或英文标签混用的情况。
